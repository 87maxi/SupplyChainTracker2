--- web/src/components/contracts/HardwareAuditForm.tsx
+++ web/src/components/contracts/HardwareAuditForm.updated.tsx
@@ -1,10 +1,11 @@
 import { useEffect, useState } from "react";
 import { Button } from "@/components/ui/button";
 import { useToast } from "@/hooks/use-toast";
 import { useSupplyChainService } from "@/hooks/useSupplyChainService";
+import { useWeb3 } from "@/contexts/Web3Context";
 import {
   Card,
   CardContent,
   CardDescription,
   CardHeader,
   CardTitle,
@@ -15,13 +16,14 @@
   DialogFooter,
   DialogHeader,
   DialogTitle,
 } from "@/components/ui/dialog";
 
 interface HardwareAuditFormProps {
   isOpen: boolean;
   onOpenChange: (open: boolean) => void;
   onComplete: () => void;
   initialSerial?: string;
+  userAddress?: string;
 }
 
 export function HardwareAuditForm({
   isOpen,
   onOpenChange,
@@ -30,11 +32,12 @@
   initialSerial,
 }: HardwareAuditFormProps) {
   const [serial, setSerial] = useState(initialSerial || "");
   const [passed, setPassed] = useState(true);
-  const [ipfsHash, setIpfsHash] = useState<string | null>(null);
+  const [auditData, setAuditData] = useState<any>(null);
   const [loading, setLoading] = useState(false);
   const { toast } = useToast();
   const { auditHardware } = useSupplyChainService();
+  const { address } = useWeb3();
 
   // Añadir efecto para actualizar el serial cuando cambie initialSerial
   useEffect(() => {
@@ -47,14 +50,6 @@
     }
   }, [initialSerial]);
 
-  // Manejador para cuando se completa la subida a IPFS
-  const handleUploadComplete = (hash: string) => {
-    setIpfsHash(hash);
-    toast({
-      title: "Informe subido",
-      description: "El informe de auditoría se ha subido a IPFS",
-    });
-  };
 
   const handleAudit = async () => {
-    if (!serial || !ipfsHash) {
+    if (!serial || !auditData) {
       toast({
         title: "Error",
         description: "Primero debe completar todos los campos",
@@ -67,11 +62,19 @@
     try {
       setLoading(true);
 
-      await auditHardware(serial, passed, ipfsHash);
+      // Create a hash from the audit data for blockchain storage
+      const encoder = new TextEncoder();
+      const data = encoder.encode(JSON.stringify(auditData));
+      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
+      const hashArray = Array.from(new Uint8Array(hashBuffer));
+      const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
+      const reportHash = `0x${hashHex.padStart(64, '0')}`;
+
+      await auditHardware(serial, passed, reportHash, address || '');
 
       toast({
         title: "Registro completado",
         description:
           "El informe de auditoría se ha registrado en la blockchain",
@@ -82,11 +85,11 @@
       // Reset form
       if (!initialSerial) setSerial("");
       setPassed(true);
-      setIpfsHash(null);
+      setAuditData(null);
 
       onComplete();
       onOpenChange(false);
     } catch (error: any) {
       console.error("Error registering on blockchain:", error);
@@ -110,6 +113,10 @@
     return "sm:max-w-[900px] h-[90vh] max-h-[90vh] flex flex-col"; // Default
   };
 
+  const handleFormSubmit = (e: React.FormEvent) => {
+    e.preventDefault();
+    // Collect form data and set it to auditData
+    // This would be implemented based on the actual form fields
+  };
+
   return (
     <Dialog open={isOpen} onOpenChange={onOpenChange}>
       <DialogContent className="sm:max-w-[900px] max-h-[90vh] overflow-y-auto">